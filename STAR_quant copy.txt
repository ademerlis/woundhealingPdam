#!/bin/bash
#BSUB -J STAR_quant
#BSUB -q general
#BSUB -P transcriptomics
#BSUB -e /projects/scratch/transcriptomics/allysondemerlis/scripts/STAR_quant.err
#BSUB -o /projects/scratch/transcriptomics/allysondemerlis/scripts/STAR_quant.out


# making a list of sample names WITHOUT TRIMMED IN THEM (i.e. it saves numbers 1-69, not 1_trimmed to 69_trimmed :) )
SAMPLES=`ls /scratch/projects/transcriptomics/allysondemerlis/sequences/trimmed_paired_sequences/ | sed 's/\(.*\)_trimmed_paired\(*\).fastq.gz/\1/g'`

for SAMP in $SAMPLES
do
echo "$SAMP"
echo '#!/bin/bash' > /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job
echo '#BSUB -J '"${SAMP}"'' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job
echo '#BSUB -q general' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job
echo '#BSUB -P transcriptomics' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job
echo '#BSUB -e /scratch/projects/transcriptomics/allysondemerlis/scripts/'"$SAMP"'_error_salmon.txt' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job
echo '#BSUB -o /scratch/projects/transcriptomics/allysondemerlis/scripts/'"$SAMP"'_output_salmon.txt' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job

echo 'echo "This is the sample being quantified -'"${SAMP}"'"' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job
echo '/scratch/projects/transcriptomics/allysondemerlis/programs/salmon-0.10.0_linux_x86_64/bin/salmon \
quant \
-t /scratch/projects/transcriptomics/allysondemerlis/sequences/Pdam_genome/pdam_genome.fasta \
-l SR \
-a /scratch/projects/transcriptomics/ben_young/apalm_v2/aligned_apal/'"$SAMP"'/'"$SAMP"'_Aligned.toTranscriptome.out.bam \
-o /scratch/projects/transcriptomics/allysondemerlis/projects/wound_healing/salmon_quant/'"${SAMP}"'_salmon' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job

echo 'echo "Sample '"${SAMP}"' has been quantified and saved"' >> /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job

bsub < /scratch/projects/transcriptomics/allysondemerlis/scripts/"$SAMP"_salmon_quant.job
done